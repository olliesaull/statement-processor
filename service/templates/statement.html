{% extends "base.html" %}
{% block title %}Statement {{ statement_id }}{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h1 class="mb-4">Statement {{ statement_id }}</h1>

    <div class="row g-4">
      <!-- Left column: raw statement table -->
      <div class="col-12 col-lg-6">
        <div class="table-responsive">
          <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
              <tr>
                {% for h in raw_statement_headers %}
                  <th>{{ h|capitalize }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% if raw_statement_rows %}
                {% for row in raw_statement_rows %}
                  {% set idx = loop.index0 %}
                  <tr class="{{ 'table-success' if row_matches[idx] else 'table-danger' }}">
                    {% for h in raw_statement_headers %}
                      <td class="{{ 'table-success' if cell_matches[idx][h] else 'table-danger' }}">
                        {{ row[loop.index0] }}
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="{{ raw_statement_headers|length }}" class="text-center text-muted">
                    No raw data found.
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>

      <!-- Right column: mirrored table (same headers), supplier ref column shows invoice_number -->
      <div class="col-12 col-lg-6">
        <div class="table-responsive">
          <table class="table table-striped table-bordered align-middle">
            <thead class="table-light">
              <tr>
                {% for h in raw_statement_headers %}
                  <th>{{ h|capitalize }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% if aligned_rows %}
                {% for ar in aligned_rows %}
                  {% set idx = loop.index0 %}
                  <tr class="{{ 'table-success' if row_matches[idx] else 'table-danger' }}">
                    {% for h in raw_statement_headers %}
                      <td class="{{ 'table-success' if cell_matches[idx][h] else 'table-danger' }}">
                        {% if h == supplier_reference_header %}
                          {{ ar.invoice_number }}
                        {% else %}
                          {{ ar.statement.get(h, '') }}
                        {% endif %}
                      </td>
                    {% endfor %}
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="{{ raw_statement_headers|length }}" class="text-center text-muted">
                    No invoice data found.
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
