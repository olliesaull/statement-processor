{% extends "base.html" %}
{% block title %}{{ 'Completed' if show_completed else 'Incomplete' }} Statements{% endblock %}

{% block content %}
  <div class="container mt-5">
    <h1 class="mb-4">{{ 'Completed Statements' if show_completed else 'Incomplete Statements' }}</h1>

    {% if message %}
      <div class="alert alert-success" role="alert">
        {{ message }}
      </div>
    {% endif %}

    {% if statements %}
      <div class="d-flex justify-content-end align-items-center gap-2 mb-3">
        <span class="text-muted">Sort by:</span>
        <div class="btn-group" role="group" aria-label="Sort statements">
          <a href="{{ sort_links.contact }}" class="btn btn-sm {% if current_sort == 'contact' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            Contact{% if current_sort == 'contact' %} {% if current_dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
          </a>
          <a href="{{ sort_links.date_range }}" class="btn btn-sm {% if current_sort == 'date_range' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            Item Date Range{% if current_sort == 'date_range' %} {% if current_dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
          </a>
          <a href="{{ sort_links.uploaded }}" class="btn btn-sm {% if current_sort == 'uploaded' %}btn-primary{% else %}btn-outline-primary{% endif %}">
            Upload Time{% if current_sort == 'uploaded' %} {% if current_dir == 'asc' %}▲{% else %}▼{% endif %}{% endif %}
          </a>
        </div>
      </div>
      <table class="table table-striped table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col">Contact Name</th>
            <th scope="col">Item Date Range</th>
            <th scope="col">Statement Filename</th>
            <th scope="col" class="text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for stmt in statements %}
            <tr>
              <td>{{ stmt.get("ContactName") or "—" }}</td>
              <td>{{ stmt.get("ItemDateRangeDisplay") or "—" }}</td>
              <td>{{ stmt.get("OriginalStatementFilename") or "—" }}</td>
              <td class="text-center">
                <div class="d-flex justify-content-center gap-2">
                  <a href="{{ url_for('statement', statement_id=stmt['StatementID']) }}"
                     class="btn btn-sm btn-primary">
                    Reconcile
                  </a>
                  <form method="post"
                        action="{{ url_for('delete_statement', statement_id=stmt['StatementID']) }}"
                        class="d-inline"
                        onsubmit="return confirm('Delete this statement? This cannot be undone.');">
                    <button type="submit" class="btn btn-sm btn-outline-danger">Delete</button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="alert alert-info">
        No {{ 'completed' if show_completed else 'incomplete' }} statements found.
      </div>
    {% endif %}

    <div class="d-flex justify-content-end gap-2 mt-4">
      {% if show_completed %}
        <a href="{{ url_for('statements', sort=current_sort, dir=current_dir) }}" class="btn btn-secondary">View incomplete</a>
      {% else %}
        <a href="{{ url_for('statements', view='completed', sort=current_sort, dir=current_dir) }}" class="btn btn-outline-secondary">View completed</a>
      {% endif %}
    </div>
  </div>
{% endblock %}
