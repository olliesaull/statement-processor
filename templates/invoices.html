{% extends "base.html" %}
{% block title %}Invoices{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Invoices</h1>
    <a class="btn btn-outline-secondary" href="{{ url_for('index') }}">Back</a>
  </div>

  {# Error state #}
  {% if error %}
    <div class="alert alert-danger" role="alert">
      <strong>{{ error }}</strong>
      {% if details %}<div class="small text-muted">{{ details }}</div>{% endif %}
    </div>
  {% elif invoices and invoices|length > 0 %}
    <div class="table-responsive">
      <table class="table table-striped align-middle">
        <thead class="table-light">
          <tr>
            <th scope="col">Number</th>
            <th scope="col">Status</th>
            <th scope="col">Date</th>
            <th scope="col">Due</th>
            <th scope="col" class="text-end">Subtotal</th>
            <th scope="col" class="text-end">Tax</th>
            <th scope="col" class="text-end">Total</th>
            <th scope="col" class="text-end">Paid</th>
            <th scope="col" class="text-end">Due</th>
            <th scope="col">Currency</th>
            <th scope="col">Contact</th>
          </tr>
        </thead>
        <tbody>
          {% for inv in invoices %}
            <tr>
              <td>{{ inv.number or '—' }}</td>
              <td>
                {% set s = (inv.status or '') %}
                <span class="badge
                  {% if s == 'DRAFT' %}bg-secondary
                  {% elif s == 'AUTHORISED' %}bg-success
                  {% elif s == 'PAID' %}bg-success
                  {% elif s == 'VOIDED' %}bg-dark
                  {% else %}bg-info text-dark{% endif %}">
                  {{ s }}
                </span>
              </td>
              <td>{{ inv.date or '—' }}</td>
              <td>{{ inv.due_date or '—' }}</td>
              <td class="text-end">{{ inv.subtotal if inv.subtotal is not none else '—' }}</td>
              <td class="text-end">{{ inv.total_tax if inv.total_tax is not none else '—' }}</td>
              <td class="text-end">{{ inv.total if inv.total is not none else '—' }}</td>
              <td class="text-end">{{ inv.amount_paid if inv.amount_paid is not none else '—' }}</td>
              <td class="text-end">{{ inv.amount_due if inv.amount_due is not none else '—' }}</td>
              <td>{{ inv.currency or '—' }}</td>
              <td>{{ inv.contact.name if inv.contact else '—' }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="text-center text-muted py-5">
      <p class="mb-1">No invoices found for this contact.</p>
      <p class="small">Try a different contact or date range.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
